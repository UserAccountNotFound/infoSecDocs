stages:
  - build
  - deploy

build_docs_job:
  stage: build
  tags: [docker]
  only:
    - /^main$/
    - merge_requests
  image: 
    name: squidfunk/mkdocs-material
    entrypoint: [""]
  script:
    - 'mkdocs build --site-dir dist'
  artifacts:
    name: "site_$($CI_PIPELINE_IID)"
    paths:
      - dist

deploy:
  stage: deploy
  tags: [nginx]
  image:
    name: squidfunk/mkdocs-material
    entrypoint: [""]
  dependencies:
    - build_docs_job
  only:
    - /^main$/
  before_script:
    - (if [ -d "site" ]; then echo ok; else exit "папки сборки нет, попробуйте запустить конвейер еще раз"; fi);
  script:
    - cp -r dist/* /srv/www/infosec.esu.gsp.local